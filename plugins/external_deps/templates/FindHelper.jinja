# AUTOGENERATED, DON'T CHANGE THIS FILE!
{% set libraries_variable = libraries.variable|default('%s_LIBRARIES'|format(name)) %}
{% set includes_variable = includes.variable|default('%s_INCLUDE_DIRS'|format(name)) %}
{% set programs_variable = programs.variable|default('%s_EXECUTABLE'|format(name)) %}
{% set programs_enabled = programs and programs.enabled|default(true) %}

{% set full_error_message = '' %}
{% if fail_message %}
  {% set full_error_message = fail_message|trim %}
{% else %}
  {% set full_error_message = "Could not find `{}` package.".format(name) %}
{% if debian_names %}
    {% set full_error_message = full_error_message + " Debian: sudo apt update && sudo apt install " + ' '.join(debian_names) %}
{% endif %} {# if debian_names #}
{% if formula_name %}
    {% set full_error_message = full_error_message + " MacOS: brew install {}".format(formula_name) %}
{% endif %} {# if formula_name #}
{% endif %} {# if fail_message #}
{% if version %}
    {% set full_error_message = full_error_message + ' Version: {}'.format(version) %}
{% endif %} {# if version #}

{% macro cmake_find(type, variable, values) %}
{% if values.find|default(false) %}
{% for value in values.find %}
find_{{ type }}({{ variable }}_{{ value.names|join('_')|replace('/', '_')|replace('.', '_') }} NAMES
  {{ value.names|join(' ') }}
{% if value['path-suffixes'] %}
    PATH_SUFFIXES
      {{ value['path-suffixes']|join(' ') }}
{% endif %} {# if value['path-suffixes'] #}
{% if value['paths'] %}
    PATHS
      {{ value['paths']|join(' ') }}
{% endif %} {# if value['paths'] #}
)
list(APPEND {{ variable }} 
  {{ '${' }}{{ variable }}_{{ value.names|join('_')|replace('/', '_')|replace('.', '_') }}{{ '}'}}
)
{% endfor %} {# for value in values.find #}
{% endif %} {# values.find|default(false) #}
{% endmacro %} {# macro cmake_find(type, variable, value) #}

{% if checks %}
{% for check in checks %}
if({{ check.expression }})
  message(FATAL_ERROR "{{ check.error }}")
endif({{ check.expression }})
{% endfor %} {# for check in checks #}
{% endif %} {# if checks #}

{% if not virtual %}

include(FindPackageHandleStandardArgs)

{{ cmake_find('library', libraries_variable, libraries) }}
{{ cmake_find('path', includes_variable, includes) }}
{{ cmake_find('program', programs_variable, programs) }}

{% if not libraries.find|default(false) and not includes.find|default(false) and not programs.find|default(false) %}
find_package({{ common_name or package_name or name }} {{ version or '' }} QUIET
{% if common_name %}
    COMPONENTS {{ name }}
{% endif %} {# if common_name #}
)
{% endif %} {# if not libraries.find.names|default(false) and not includes.names|default(false) #}

{% if libraries.find|default(false) or includes.find|default(false) or programs.find|default(false) %}
find_package_handle_standard_args(
  {{ package_name or name }}
    REQUIRED_VARS
      {{ libraries_variable if libraries.enabled|default(true) else '' }}
      {{ includes_variable if includes.enabled|default(true) else '' }}
      {{ programs_variable if programs_enabled else '' }}
    FAIL_MESSAGE
      "{{ full_error_message }}"
)
mark_as_advanced(
  {{ libraries_variable if libraries.enabled|default(true) else '' }}
  {{ includes_variable if includes.enabled|default(true) else '' }}
  {{ programs_variable if programs_enabled else '' }}
)
{% endif %} {# if not package_name #}

if(NOT {{ common_name or package_name or name }}_FOUND)
  message(FATAL_ERROR "{{ full_error_message }}")
endif(NOT {{ common_name or package_name or name }}_FOUND)

{% endif %} {# if not virtual #}

{% if common_name or libraries.enabled|default(true) or includes.enabled|default(true) or virtual  %}
{#if (NOT TARGET {{ '{}::'.format(common_name) if common_name else '' }}{{ name }})#}
if (NOT TARGET {{ name }})
  add_library({{ name }} INTERFACE IMPORTED GLOBAL)
{% if common_name %}
  if (TARGET {{ '{}::{}'.format(common_name, name) }})
    target_link_libraries({{ name }} INTERFACE {{ '{}::{}'.format(common_name, name) }})
{#    add_library({{ name }} ALIAS {{ '{}::{}'.format(common_name, name) }})#}
  endif(TARGET {{ '{}::{}'.format(common_name, name) }})
{% endif %} {# if common_name #}
{% if includes.enabled|default(true) %}
  target_include_directories({{ name }} INTERFACE {{ '${' }}{{ includes_variable }}{{ '}'}})
{% endif %} {# if includes.enabled|default(true) #}
{% if libraries.enabled|default(true) %}
  target_link_libraries({{ name }} INTERFACE {{ '${' }}{{ libraries_variable }}{{ '}'}})
{% endif %} {# if libraries.enabled|default(true) #}
{% if compile_definitions.names %}
  target_compile_definitions({{ name }} INTERFACE
{%- for option in compile_definitions.names %}  
    {{ option }}
{% endfor %} {# for option in compile_definitions.names #}
  )
{% endif %} {# if compile_definitions.names #}
{#endif(NOT TARGET {{ '{}::'.format(common_name) if common_name else '' }}{{ name }})#}
endif(NOT TARGET {{ name }})
{% endif %}
